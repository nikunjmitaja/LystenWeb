@{
    ViewBag.Title = "Email Templates";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="content">
    <div class="container-fluid container-fixed-lg">
        <ul class="breadcrumb">
            <li>
                <a href="#">Dashboard</a>
            </li>
            <li>
                <a href="#" class="active">@ViewBag.Title</a>
            </li>
        </ul>
    </div>

    <!-- Modal content-->
    <div class="container-fluid container-fixed-lg bg-white">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-transparent">
                    <div class="panel-title">
                        Email Templates
                    </div>
                    <div class="panel-body">
                        <div class="form-horizontal">
                            <div class="form-group ">
                                <label for="Title" class="col-sm-3 control-label">Title</label>
                                <div class="col-sm-9">
                                    <input type="hidden" id="hdnemailaccountid" />
                                    <input type="text" class="form-control RequiredControlEmail" id="txttitle" placeholder="Title" required >
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="Subject" class="col-sm-3 control-label">Subject</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control RequiredControlEmail" id="txtsubject" placeholder="Subject" required="" aria-required="true">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="System" class="col-sm-3 control-label">System Name</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control RequiredControlEmail" id="txtsname" placeholder="System Name" required="" aria-required="true">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="Body" class="col-sm-3 control-label">Body</label>
                                <div class="col-sm-9">
                                    <textarea id="txteditor" class="ckeditor form-control" name="editor1" rows="6"></textarea>
                                </div>
                            </div>
                            <br />
                            <div class="row">
                                <div class="col-sm-3">
                                    <p>I hereby certify that the information above is true and accurate. </p>
                                </div>
                                <div class="col-sm-9">
                                    <a href="#" id="btnsave" onclick="SaveEmailTemplateData()" class="btn btn-primary btn-rounded">Update</a>
                                    <button type="button" data-dismiss="modal" onclick="Clear()" class="btn btn-default  btn-rounded">Close</button>
                                </div>
                            </div>
                            <div class="form-group">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
           
        </div>
    </div>
    <div class="container-fluid container-fixed-lg bg-white">
        <div class="panel panel-transparent">
            <div class="panel-body">
                <table class="table table-hover demo-table-dynamic table-responsive-block" id="tblemailaccount" aria-describedby="sample_1_info">
                    <thead>
                        <tr>
                            <th>TemplateId</th>
                            <th>Title</th>
                            <th>Subject</th>
                            <th>System name</th>
                            <th>Body</th>
                            <th>Edit</th>
                        </tr>
                    </thead>
                    <tbody role="alert" aria-live="polite" aria-relevant="all"></tbody>
                </table>
            </div>
        </div>
    </div>
    </div>
<div class="text-center text-green hide p15" id="lblmessage"></div>



@*<div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading"><i class="fa fa-globe"></i> Email Account</div>
                <div class="panel-body">
                    <div class="container">
                        <!-- BEGIN VALIDATION STATES-->
                        <div class="portlet">
                            <div class="portlet-body form">
                                <!-- BEGIN FORM-->
                                <form action="#" id="form_sample_3" class="form-horizontal">
                                    <div class="form-body">
                                        <div class="form-group">
                                            <input type="hidden" id="hdnemailaccountid" />
                                            <label class="control-label col-md-3">
                                                Title
                                                <span class="requiredred">
                                                    *
                                                </span>
                                            </label>
                                            <div class="col-md-4">
                                                <input type="text" placeholder="Title" id="txttitle" class="form-control RequiredControlEmail" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-3">
                                                Subject
                                                <span class="requiredred">
                                                    *
                                                </span>
                                            </label>
                                            <div class="col-md-4">
                                                <input type="text" placeholder="Subject" id="txtsubject" class="form-control RequiredControlEmail" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-3">
                                                System Name
                                                <span class="requiredred">
                                                    *
                                                </span>
                                            </label>
                                            <div class="col-md-4">
                                                <input type="text" placeholder="System Name" id="txtsname" class="form-control RequiredControlEmail" />
                                            </div>
                                        </div>
                                        <div class="form-group last">
                                            <label class="control-label col-md-3">
                                                Body
                                                <span class="requiredred">
                                                    *
                                                </span>
                                            </label>
                                            <div class="col-md-9">
                                                <textarea id="txteditor" class="ckeditor form-control" name="editor1" rows="6"></textarea>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="form-group col-md-offset-9 m_top_20 p0 col-md-6">
                                        <div class="col-xs-4">
                                            <input type="button" class="btn btn-primary custom btn-block" id="btnsave" value="Save" onclick="SaveEmailTemplateData()" />
                                        </div>
                                        <div class="col-xs-4">
                                            <input type="button" class="btn btn-primary custom btn-block" id="" value="Cancel" onclick="Clear()" />
                                        </div>
                                    </div>
                                </form>
                                <!-- END FORM-->
                            </div>
                            <!-- END VALIDATION STATES-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>*@

<script type="text/javascript">

    function Clear() {
        $("#hdnemailaccountid").val('');
        $('#btnsave').text("Save");
        $("#txttitle").val('');
        $("#txtsname").val('');
        $("#txtsubject").val('');
        //CKEDITOR.instances['txteditor'].setData('')
        $('#txteditor').val('');
        for (name in CKEDITOR.instances) {
            debugger
            CKEDITOR.instances['txteditor'].setData('');
        }
        $('.RequiredControlEmail').each(function () {
                $(this).removeClass("has-error")
        });
        $("#txteditor").parent().removeClass("has-error")
    }


    function EditEmailTemplate(TemplateId) {
        var isValid = true;
        if (isValid) {
            var jsonData = {
                TemplateId: TemplateId
            };
            $.ajax({
                type: "POST",
                url: '@Url.Action("EditEmailTempData", "Master")',
                data: JSON.stringify(jsonData),
                contentType: 'application/json; charset=utf-8'
            }).done(function (data) {
                scrolltop();
                $("#hdnemailaccountid").val(data.Id)
                $('#txtsubject').val(data.Subject);
                $('#txttitle').val(data.Title);
                $('#btnsave').text("Update");
                $('#txtsname').val(data.SystemName);
                $(".cke_editable").val(data.Body)
                CKEDITOR.instances['txteditor'].setData(data.Body)
            })
        }
    }

    function scrolltop() {
        $('html,body').animate({
            scrollTop: $("body").offset().top
        },
  'slow');
    }

    function SaveEmailTemplateData() {
        debugger;
        var isValid = true;
        $('.RequiredControlEmail').each(function () {
            if ($.trim($(this).val()) == '') {
                isValid = false;
                $(this).parent().addClass("has-error")
            }
            else {
                $(this).parent().removeClass("has-error")
            }
        });
        if (CKEDITOR.instances['txteditor'].getData() == '') {
            isValid = false;
            $("#txteditor").parent().parent().parent().addClass("has-error")
            $("#cke_txteditor").attr("style","border:1px solid red")
        }
        else {
            $("#txteditor").parent().parent().parent().removeClass("has-error")
            $("#cke_txteditor").attr("style", "")


        }

        if (isValid) {
            var jsonData = {
                Id: $("#hdnemailaccountid").val(),
                Title: $("#txttitle").val(),
                Subject: $("#txtsubject").val(),
                SystemName: $("#txtsname").val(),
                Body: CKEDITOR.instances['txteditor'].getData()
            };

            $.ajax({
                type: "POST",
                url: '@Url.Action("SaveEmailTemplateData", "Master")',
                data: JSON.stringify(jsonData),
                contentType: 'application/json; charset=utf-8'
            }).done(function (data) {
                if (data != '' || data !== null) {
                    if (data.Status == "Exists") {
                        display();
                        Clear();
                    }
                    else if (data.Status == "Update") {
                        display();
                        Clear();
                    }
                    else if (data.Status == "Insert") {
                        display();
                        Clear();
                    }

                }
            }).error(function (jqXHR, textStatus, errorThrown) {
                alert(errorThrown);
            });
        }
        else {
            //scrolltop();
            //var y = document.getElementsByClassName('has-error').focus();
        }
    }



    $(document).ready(function () {
        Clear();
        display();
    })
    function display() {
        var oTable = $('#tblemailaccount').DataTable({
            language: {
                "sProcessing": "<img src='../Content/images/spinner.GIF' style='margin: 0 auto;display: block;' />",
                "sSearch": '<i class="searchBtn fa fa-search"></i>',
                searchPlaceholder: "Search"
            },
            "iDisplayLength": 10,
            "bLengthChange": false,
            "bInfo": false,
            "bSort": false,
            "bDestroy": true,
            "sEmptyTable": "Loading data from server",
            "paging": true,
            "processing": true,
            "serverSide": true,
            "sAjaxSource": '@Url.Action("GetAllEmailTemplates", "Master")',
            "order": [[2, "asc"]],
            "fnServerData": function (sSource, aoData, fnCallback) {
                $.ajax({
                    "dataType": 'json',
                    "type": "POST",
                    "url": sSource,
                    "data": aoData,
                    "success": fnCallback
                });
            },
            "sEmptyTable": "Loading data from server",
            "aoColumns": [{ "bVisible": false },
                           {  },
                           {},

                             { },
                             {  },
                          {

                              "render": function (data, type, row, meta) {
                                  return '<center><a href="javascript:void(0);" title="Edit User" onclick="EditEmailTemplate(' + row[0] + ')"><i class="fa fa-edit"></i></a></center>'
                              }
                          },
            ],
            fnInitComplete: function () {
                if ($(this).find('td').eq(0).text() == 'No data available in table') {
                    $(this).parent().parent().parent().parent().hide();
                    $('#lblmessage').removeClass('hide');
                    $('#lblmessage').html('<h3 class="text-green">No Policy Added</h3> <h3>Please add Policy by pressing Add Policy</h3>');
                }
                else {
                    $(this).parent().parent().parent().parent().show();
                    $('#lblmessage').addClass('hide');
                    $('#lblmessage').html('');
                }
            }
        });
    }

</script>
